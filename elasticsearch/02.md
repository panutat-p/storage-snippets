# Aggregation

https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html

## Simple

```shell
GET /fruits/_search
{
  "size": 0,
  "aggs": {
    "colors": {
      "terms": {
        "field": "color"
      }
    }
  }
}
```

## Filter then aggregation

```shell
GET /fruits/_search
{
  "size": 0,
  "query": {
    "bool": {
      "must": [
        {"range": {"price": {"gte": 10}}}
      ]
    }
  },
  "aggs": {
    "color_group": {
      "terms": {"field": "color"}
    }
  }
}
```

## Filter aggregation

```shell
GET /fruits/_search
{
  "size": 0,
  "aggs": {
    "price_filter": {
      "filter": {
        "range": {"price": {"gte": 10}
        }
      },
      "aggs": {
        "color_group": {
          "terms": {"field": "color"}
        }
      }
    }
  }
}
```
