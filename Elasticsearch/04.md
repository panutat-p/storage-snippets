# Painless Script

## Script field

```sh
GET /fruits/_search
{
  "script_fields" : {
    "expired_at" : {
      "script" : {
        "lang": "painless",
        "source": "doc['created_at'].value.plusDays(30)"
      }
    }
  }
}
```

## Update all documents

```sh
POST /fruits/_update_by_query
{
  "script": {
    "source": "ctx._source.color = 'new color'",
    "lang": "painless"
  }
}
```

## Update filtered documents

```sh
POST /fruits/_update_by_query
{
  "script": {
    "source": "ctx._source.tags.add('fruit')",
    "lang": "painless"
  },
  "query": {
    "term": {
      "tags": "fruit"
    }
  }
}
```

## Update documents in range

```sh
POST /fruits/_update_by_query
{
  "script": {
    "source": "ctx._source.tags.add('premium')",
    "lang": "painless"
  },
  "query": {
    "range": {
      "price": {
        "gt": 100
      }
    }
  }
}
```

## Sort context

https://www.elastic.co/guide/en/elasticsearch/painless/current/painless-sort-context.html

```sh
GET /fruits/_search
{
  "sort": {
    "_script": {
      "type": "number",
      "order": "asc",
      "script": {
        "lang": "painless",
        "source": """
          if (doc['color'].value == 'red') {
            return 1;
          } else if (doc['color'].value == 'orange') {
            return 2;
          } else if (doc['color'].value == 'yellow') {
            return 3;
          } else if (doc['color'].value == 'blue') {
            return 4;
          } else if (doc['color'].value == 'green') {
            return 5;
          } else {
            return 6;
          }
        """
      }
    }
  }
}
```
